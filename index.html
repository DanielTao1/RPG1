<!DOCTYPE html>
<html>
<head>
	<title>å¯è¿è¡Œçš„2D RPG</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		body { 
			font-family: 'Arial Rounded MT Bold', Arial; 
			background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			margin: 0;
			padding: 20px;
			min-height: 100vh;
			touch-action: none;
		}
		.container {
			max-width: 1200px;
			margin: 0 auto;
			position: relative;
		}
		.panel {
			background: rgba(255, 255, 255, 0.95);
			padding: 25px;
			border-radius: 20px;
			box-shadow: 0 8px 32px rgba(0,0,0,0.1);
			margin-bottom: 25px;
			backdrop-filter: blur(10px);
		}
		.hidden { display: none; }
		button {
			padding: 15px 30px;
			margin: 10px;
			background: #ff7f50;
			color: white;
			border: none;
			border-radius: 30px;
			cursor: pointer;
			font-size: 16px;
			transition: all 0.3s;
			box-shadow: 0 4px 6px rgba(0,0,0,0.1);
		}
		button:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 12px rgba(0,0,0,0.2);
			background: #ff6347;
		}
		.shop { 
			border: 3px solid #ffd700;
			background: #fffacd;
		}
		#gameMap {
			display: grid;
			grid-template-columns: repeat(10, 50px);
			gap: 2px;
			margin: 20px auto;
			background: #a3d8a3;
			padding: 10px;
			border-radius: 10px;
			touch-action: none;
		}
		.cell {
			width: 50px;
			height: 50px;
			background: rgba(255,255,255,0.3);
			border-radius: 5px;
			position: relative;
		}
		#player {
			width: 40px;
			height: 40px;
			background: url('https://cdn-icons-png.flaticon.com/512/606/606797.png') center/contain no-repeat;
			position: absolute;
			transition: all 0.2s;
			filter: drop-shadow(0 0 5px rgba(255,0,0,0.5));
			z-index: 2;
		}
		.monster {
			width: 40px;
			height: 40px;
			position: absolute;
			font-size: 30px;
			text-align: center;
			cursor: pointer;
			transition: all 0.3s;
			z-index: 1;
			user-select: none;
		}
		.monster::after {
			content: '';
			position: absolute;
			width: 20px;
			height: 20px;
			background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M20 70 Q50 30 80 70 M30 50 L35 60 M45 50 L50 60 M55 50 L60 60 M65 50 L70 60" stroke="black" fill="none"/></svg>') center/contain;
			bottom: -15px;
			left: 50%;
			transform: translateX(-50%);
		}
		.status-box {
			background: rgba(255, 255, 255, 0.9);
			padding: 20px;
			border-radius: 15px;
			margin: 15px 0;
			box-shadow: 0 4px 6px rgba(0,0,0,0.05);
			min-width: 300px;
		}
		.damage-effect {
			animation: damage 0.3s;
		}
		@keyframes damage {
			0% { transform: translateX(0); }
			25% { transform: translateX(15px); }
			50% { transform: translateX(-15px); }
			100% { transform: translateX(0); }
		}
		#mapContainer {
			position: relative;
			margin-right: 30px;
		}
		#gameArea {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
		}
		.control-pad {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
			margin-top: 20px;
		}
		.control-btn {
			width: 60px;
			height: 60px;
			background: rgba(0,0,0,0.1);
			border-radius: 15px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 24px;
		}
	</style>
</head>
<body>
	<div class="container">
		<!-- ç™»å½•ç•Œé¢ -->
		<div id="loginPanel" class="panel">
			<h2>ğŸŒ¸ æ¬¢è¿æ¥åˆ°2D RPGä¸–ç•Œ ğŸŒ¸</h2>
			<input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
			<input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
			<button onclick="login()">âœ¨ å¼€å§‹å†’é™©</button>
		</div>

		<!-- æ¸¸æˆç•Œé¢ -->
		<div id="gamePanel" class="panel hidden">
			<div id="gameArea">
				<div id="mapContainer">
					<div id="gameMap"></div>
					<div id="player"></div>
				</div>
				
				<div class="status-box">
					<h3 style="color: #e84393;">ğŸ‘¸ ç©å®¶çŠ¶æ€</h3>
					<p>ğŸ·ï¸ ç­‰çº§: <span id="level">1</span></p>
					<p>â¤ï¸ è¡€é‡: <span id="playerHp">100</span>/<span id="maxHp">100</span></p>
					<p>âš”ï¸ æ”»å‡»åŠ›: <span id="attack">10</span></p>
					<p>âœ¨ ç»éªŒ: <span id="exp">0</span>/<span id="maxExp">100</span></p>
					<p>ğŸª™ é‡‘å¸: <span id="money">1000</span></p>
					<button onclick="toggleShop()">ğŸ›’ æ‰“å¼€å•†åº—</button>
				</div>
			</div>
			
			<!-- ç§»åŠ¨ç«¯æ§åˆ¶ -->
			<div class="control-pad hidden" id="mobileControls">
				<div class="control-btn" onclick="move('up')">â†‘</div>
				<div class="control-btn" onclick="move('left')">â†</div>
				<div class="control-btn" onclick="move('down')">â†“</div>
				<div class="control-btn" onclick="move('right')">â†’</div>
			</div>
		</div>

		<!-- å•†åº—ç•Œé¢ -->
		<div id="shopPanel" class="panel shop hidden">
			<h2 style="color: #fdcb6e;">ğŸ›ï¸ è£…å¤‡å•†åº—</h2>
			<button onclick="buyWeapon(20, 2000)">âš”ï¸ é’é“œå‰‘ (+20æ”»å‡») ğŸª™2000</button>
			<button onclick="buyWeapon(50, 5000)">ğŸ”ª ç™½é“¶åˆ€ (+50æ”»å‡») ğŸª™5000</button>
			<button onclick="buyWeapon(100, 10000)">ğŸ—¡ï¸ é»„é‡‘åœ£å‰‘ (+100æ”»å‡») ğŸª™10000</button>
			<button style="background: #ff4757;" onclick="toggleShop()">âŒ å…³é—­å•†åº—</button>
		</div>
	</div>

	<script>
		let currentUser = null;
		let playerPos = {x: 4, y: 4};
		let monsters = [];
		const userTemplate = {
			level: 1,
			exp: 0,
			money: 1000,
			attack: 10,
			hp: 100,
			maxHp: 100,
			stage: 1
		};

		function login() {
			const username = document.getElementById('username').value;
			const password = document.getElementById('password').value;
			if(!username || !password) return alert("è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ");

			const users = JSON.parse(localStorage.getItem('users') || '{}');
			if(!users[username]) {
				users[username] = {...userTemplate};
				localStorage.setItem('users', JSON.stringify(users));
			}

			currentUser = users[username];
			startGame();
		}

		function startGame() {
			document.getElementById('loginPanel').classList.add('hidden');
			document.getElementById('gamePanel').classList.remove('hidden');
			
			// æ£€æµ‹ç§»åŠ¨ç«¯æ˜¾ç¤ºæ§åˆ¶æŒ‰é’®
			if(/Mobi|Android/i.test(navigator.userAgent)) {
				document.getElementById('mobileControls').classList.remove('hidden');
			}
			
			initializeGame();
			setInterval(gameLoop, 1000);
		}

		function initializeGame() {
			generateMap();
			updatePlayerPosition();
			generateMonsters(3);
			updateDisplay();
			
			// æ·»åŠ äº‹ä»¶ç›‘å¬
			document.addEventListener('keydown', handleKeyPress);
		}

		function generateMap() {
			const map = document.getElementById('gameMap');
			map.innerHTML = '';
			for(let i = 0; i < 100; i++) {
				const cell = document.createElement('div');
				cell.className = 'cell';
				map.appendChild(cell);
			}
		}

		function generateMonsters(count) {
			// æ¸…é™¤æ—§æ€ªç‰©
			monsters.forEach(m => m.remove());
			monsters = [];
			
			for(let i = 0; i < count + currentUser.stage; i++) {
				const monster = createMonsterElement();
				document.getElementById('mapContainer').appendChild(monster);
				monsters.push(monster);
			}
		}

		function createMonsterElement() {
			const monster = document.createElement('div');
			monster.className = 'monster';
			monster.textContent = 'ğŸ‘¿';
			
			// è®¾ç½®éšæœºä½ç½®
			let x, y;
			do {
				x = Math.floor(Math.random() * 10);
				y = Math.floor(Math.random() * 10);
			} while(x === playerPos.x && y === playerPos.y) // é¿å…ç”Ÿæˆåœ¨ç©å®¶ä½ç½®
			
			monster.style.left = `${x * 52 + 5}px`;
			monster.style.top = `${y * 52 + 5}px`;
			
			// æ ¹æ®å…³å¡è°ƒæ•´é¢œè‰²
			const hue = 90 + (currentUser.stage-1)*30;
			monster.style.filter = `hue-rotate(${hue}deg)`;
			
			monster.addEventListener('click', () => attackMonster(monster));
			return monster;
		}

		function handleKeyPress(e) {
			e.preventDefault();
			const directions = {
				ArrowUp: 'up',
				ArrowDown: 'down',
				ArrowLeft: 'left',
				ArrowRight: 'right'
			};
			if(directions[e.key]) move(directions[e.key]);
		}

		function move(direction) {
			const newPos = {...playerPos};
			switch(direction) {
				case 'up': if(newPos.y > 0) newPos.y--; break;
				case 'down': if(newPos.y < 9) newPos.y++; break;
				case 'left': if(newPos.x > 0) newPos.x--; break;
				case 'right': if(newPos.x < 9) newPos.x++; break;
			}
			playerPos = newPos;
			updatePlayerPosition();
		}

		function updatePlayerPosition() {
			const player = document.getElementById('player');
			player.style.left = `${playerPos.x * 52 + 5}px`;
			player.style.top = `${playerPos.y * 52 + 5}px`;
		}

		function attackMonster(monster) {
			const rect = monster.getBoundingClientRect();
			const playerRect = document.getElementById('player').getBoundingClientRect();
			
			// è®¡ç®—è·ç¦»ï¼ˆä¸¤ä¸ªå…ƒç´ ä¸­å¿ƒç‚¹è·ç¦»ï¼‰
			const dx = rect.left + 20 - (playerRect.left + 20);
			const dy = rect.top + 20 - (playerRect.top + 20);
			const distance = Math.sqrt(dx*dx + dy*dy);
			
			if(distance < 60) { // å…è®¸1æ ¼è·ç¦»æ”»å‡»
				// ç©å®¶æ”»å‡»
				monster.classList.add('damage-effect');
				currentUser.money += 50 * currentUser.stage;
				currentUser.exp += 20 * currentUser.stage;
				
				setTimeout(() => {
					monster.remove();
					monsters = monsters.filter(m => m !== monster);
					if(monsters.length === 0) {
						currentUser.stage++;
						generateMonsters(3);
					}
					updateDisplay();
				}, 300);
				
				// æ€ªç‰©åå‡»
				currentUser.hp -= 5 * currentUser.stage;
				document.getElementById('player').classList.add('damage-effect');
				setTimeout(() => document.getElementById('player').classList.remove('damage-effect'), 300);
				
				checkGameStatus();
				checkLevelUp();
				saveData();
				updateDisplay();
			}
		}

		function checkLevelUp() {
			const requiredExp = 100 * Math.pow(2, currentUser.level - 1);
			if(currentUser.exp >= requiredExp) {
				currentUser.level++;
				currentUser.exp -= requiredExp;
				currentUser.maxHp += 100;
				currentUser.hp = currentUser.maxHp;
				updateDisplay();
				alert(`âœ¨ å‡çº§åˆ° ${currentUser.level} çº§ï¼`);
			}
		}

		function checkGameStatus() {
			if(currentUser.hp <= 0) {
				alert('ğŸ’€ æ¸¸æˆç»“æŸï¼');
				currentUser = {...userTemplate};
				generateMonsters(3);
				saveData();
				updateDisplay();
			}
		}

		function buyWeapon(attack, price) {
			if(currentUser.money >= price) {
				currentUser.attack = attack;
				currentUser.money -= price;
				document.getElementById('player').style.filter = 
					`hue-rotate(${(attack-10)*3}deg) drop-shadow(0 0 10px rgba(255,${attack*2},0,0.3))`;
				updateDisplay();
				saveData();
			} else {
				alert('é‡‘å¸ä¸è¶³ï¼');
			}
		}

		function toggleShop() {
			document.getElementById('shopPanel').classList.toggle('hidden');
		}

		function updateDisplay() {
			document.getElementById('level').textContent = currentUser.level;
			document.getElementById('exp').textContent = currentUser.exp;
			document.getElementById('maxExp').textContent = 100 * Math.pow(2, currentUser.level - 1);
			document.getElementById('money').textContent = currentUser.money;
			document.getElementById('attack').textContent = currentUser.attack;
			document.getElementById('playerHp').textContent = currentUser.hp;
			document.getElementById('maxHp').textContent = currentUser.maxHp;
		}

		function saveData() {
			const users = JSON.parse(localStorage.getItem('users') || '{}');
			users[document.getElementById('username').value] = currentUser;
			localStorage.setItem('users', JSON.stringify(users));
		}

		// æ¸¸æˆå¾ªç¯
		function gameLoop() {
			currentUser.exp += Math.pow(2, currentUser.level - 1);
			checkLevelUp();
			saveData();
			updateDisplay();
		}
	</script>
</body>
</html>
